<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Networking for ICN (`icn-network`)"><title>icn_network - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-1a91846b.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="icn_network" data-themes="" data-resource-suffix="" data-rustdoc-version="1.88.0 (6b00bc388 2025-06-23)" data-channel="1.88.0" data-search-js="search-f7877310.js" data-settings-js="settings-5514c975.js" ><script src="../static.files/storage-4e99c027.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-7ef8a74a.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../icn_network/index.html">icn_<wbr>network</a><span class="version">0.2.0</span></h2></div><div class="sidebar-elems"><ul class="block"><li><a id="all-types" href="all.html">All Items</a></li></ul><section id="rustdoc-toc"><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#networking-for-icn-icn-network" title="Networking for ICN (`icn-network`)">Networking for ICN (<code>icn-network</code>)</a><ul><li><a href="#purpose" title="Purpose">Purpose</a></li><li><a href="#key-components" title="Key Components">Key Components</a></li><li><a href="#error-handling" title="Error Handling">Error Handling</a></li><li><a href="#libp2p-feature" title="`libp2p` Feature"><code>libp2p</code> Feature</a></li><li><a href="#kademlia-dht" title="Kademlia DHT">Kademlia DHT</a></li><li><a href="#message-signing" title="Message Signing">Message Signing</a></li><li><a href="#public-api-style" title="Public API Style">Public API Style</a></li><li><a href="#examples" title="Examples">Examples</a></li><li><a href="#contributing" title="Contributing">Contributing</a></li><li><a href="#license" title="License">License</a></li></ul></li><li><a href="#networking-crate-for-icn---production-ready-p2p-networking" title="Networking Crate for ICN - Production-Ready P2P Networking">Networking Crate for ICN - Production-Ready P2P Networking</a></li></ul><h3><a href="#reexports">Crate Items</a></h3><ul class="block"><li><a href="#reexports" title="Re-exports">Re-exports</a></li><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Crate <span>icn_network</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/icn_network/lib.rs.html#1-1630">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="networking-for-icn-icn-network"><a class="doc-anchor" href="#networking-for-icn-icn-network">§</a>Networking for ICN (<code>icn-network</code>)</h2>
<p>This crate manages peer-to-peer (P2P) networking aspects for the InterCooperative Network (ICN).
It defines the core networking abstractions, message types, and service interfaces. A lightweight stub service is available for tests, while production builds enable a libp2p-based implementation via the <code>libp2p</code> feature.</p>
<p>See <a href="../../CONTEXT.md">CONTEXT.md</a> for ICN Core design philosophy and crate roles.
See <a href="../../docs/ASYNC_OVERVIEW.md">docs/ASYNC_OVERVIEW.md</a> for async API guidelines.</p>
<h3 id="purpose"><a class="doc-anchor" href="#purpose">§</a>Purpose</h3>
<p>The <code>icn-network</code> crate is responsible for:</p>
<ul>
<li><strong>P2P Communication:</strong> Establishing and managing connections between ICN nodes.</li>
<li><strong>Transport Protocols:</strong> Abstracting underlying transport mechanisms (e.g., TCP, QUIC).</li>
<li><strong>Peer Discovery:</strong> Finding and connecting to other peers in the network.
The <code>Libp2pNetworkService</code> performs periodic discovery using Kademlia with
a configurable <code>peer_discovery_interval</code> and will retry dialing configured
bootstrap peers.</li>
<li><strong>Message Definition &amp; Routing:</strong> Defining common network message types and handling their exchange between peers.</li>
<li><strong>Federation Synchronization:</strong> Potentially handling specific protocols for data synchronization between federated ICN clusters.</li>
</ul>
<h3 id="key-components"><a class="doc-anchor" href="#key-components">§</a>Key Components</h3>
<ul>
<li><strong><code>PeerId</code></strong>: A struct representing a unique identifier for a network peer. Currently a simple string wrapper, but intended to be compatible with underlying P2P library IDs (e.g., libp2p <code>PeerId</code>).</li>
<li><strong><code>ProtocolMessage</code></strong>: A signed envelope containing a <code>MessagePayload</code>. The payload represents specific actions such as block announcements (<code>DagBlockAnnouncement</code>), block requests (<code>DagBlockRequest</code>), generic gossip messages (<code>GossipMessage</code>), federation sync requests, and federation join handshakes. The struct derives <code>Serialize</code> and <code>Deserialize</code> for transmission.</li>
<li><strong><code>SignedMessage</code></strong>: Wraps a <code>ProtocolMessage</code> together with the sender’s DID and an Ed25519 signature. Helpers <code>sign_message</code> and <code>verify_message_signature</code> are provided to create and validate these structures.</li>
<li><strong><code>NetworkService</code> Trait</strong>: An abstraction defining the core functionalities a network service provider must implement. This includes methods like <code>discover_peers</code>, <code>send_message</code>, and <code>broadcast_message</code>. Methods return <code>Result&lt;_, CommonError&gt;</code> using specific error variants like <code>PeerNotFound</code>, <code>MessageSendError</code>, etc.</li>
<li><strong><code>StubNetworkService</code></strong>: A default implementation of <code>NetworkService</code> that simulates network interactions by logging actions to the console and returning predefined data. It’s used for development and testing of higher-level crates without requiring a live P2P network. It demonstrates returning specific <code>CommonError</code> variants for simulated network issues.</li>
</ul>
<h3 id="error-handling"><a class="doc-anchor" href="#error-handling">§</a>Error Handling</h3>
<p>Functions and methods within this crate return <code>Result&lt;T, CommonError&gt;</code>, utilizing specific variants from <code>icn_common::CommonError</code> relevant to networking, such as:</p>
<ul>
<li><code>CommonError::PeerNotFound</code></li>
<li><code>CommonError::MessageSendError</code></li>
<li><code>CommonError::NetworkConnectionError</code></li>
<li><code>CommonError::NetworkUnhealthy</code></li>
</ul>
<p>The <code>StubNetworkService</code> also simulates these errors to help test error handling in dependent crates.</p>
<h3 id="libp2p-feature"><a class="doc-anchor" href="#libp2p-feature">§</a><code>libp2p</code> Feature</h3>
<p>This crate exposes an optional <code>libp2p</code> feature. When enabled it pulls in the <code>libp2p</code> and <code>libp2p-request-response</code> dependencies, providing a production ready <code>NetworkService</code> backed by the libp2p stack.</p>
<h3 id="kademlia-dht"><a class="doc-anchor" href="#kademlia-dht">§</a>Kademlia DHT</h3>
<p>When compiled with the <code>libp2p</code> feature, the network layer exposes
basic Kademlia distributed hash table (DHT) functionality. This allows nodes to
store small records in the DHT and to discover peers through the standard
libp2p Kademlia protocol.</p>
<p>Kademlia commands are disabled in the stub service and only become available in
the <code>Libp2pNetworkService</code> when the feature flag is enabled. Be sure to compile
with:</p>
<div class="example-wrap"><pre class="language-bash"><code>cargo build --features libp2p</code></pre></div>
<p>to use the <code>get_kademlia_record</code> and <code>put_kademlia_record</code> APIs as well as peer
discovery via the DHT.</p>
<h3 id="message-signing"><a class="doc-anchor" href="#message-signing">§</a>Message Signing</h3>
<p>All network messages should be authenticated. The helper function <code>sign_message</code>
takes a <code>ProtocolMessage</code>, the sender’s <code>Did</code>, and a signing key to produce a
<code>SignedMessage</code>. Peers can verify authenticity using
<code>verify_message_signature</code>, which resolves the public key from the DID and
checks the Ed25519 signature. The <code>StubNetworkService</code> verifies signatures for
<code>send_signed_message</code> and <code>broadcast_signed_message</code> calls.</p>
<h3 id="public-api-style"><a class="doc-anchor" href="#public-api-style">§</a>Public API Style</h3>
<p>This crate provides:</p>
<ul>
<li>Data structures (<code>PeerId</code>, <code>ProtocolMessage</code>, <code>MessagePayload</code>).</li>
<li>A core trait (<code>NetworkService</code>) for P2P interactions.</li>
<li>A concrete stub implementation (<code>StubNetworkService</code>) for testing.</li>
<li>With the <code>libp2p</code> feature enabled, a full <code>Libp2pNetworkService</code> and DHT record APIs (<code>get_kademlia_record</code> and <code>put_kademlia_record</code>).</li>
</ul>
<p>The API aims for modularity, allowing different P2P backends to be integrated by implementing the <code>NetworkService</code> trait.</p>
<h3 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h3>
<p>The <code>tests</code> directory provides runnable examples that use the real libp2p
networking stack. The <a href="tests/handshake_pubsub.rs"><code>handshake_pubsub.rs</code></a> test
spawns two <code>Libp2pNetworkService</code> instances, performs a handshake, and
exchanges a gossipsub message. Run it with:</p>
<div class="example-wrap"><pre class="language-bash"><code>cargo test -p icn-network --features libp2p handshake_pubsub</code></pre></div><h3 id="contributing"><a class="doc-anchor" href="#contributing">§</a>Contributing</h3>
<p>Please refer to the main <code>CONTRIBUTING.md</code> in the root of the <code>icn-core</code> repository.</p>
<p>Key areas for future contributions:</p>
<ul>
<li>Extending the existing <code>Libp2pNetworkService</code> and refining peer discovery.</li>
<li>Defining and implementing robust peer discovery mechanisms.</li>
<li>Implementing secure and efficient message serialization and transport.</li>
<li>Adding support for various transport protocols.</li>
</ul>
<h3 id="license"><a class="doc-anchor" href="#license">§</a>License</h3>
<p>This crate is licensed under the Apache 2.0 license, as is the entire <code>icn-core</code> repository.</p>
<h2 id="networking-crate-for-icn---production-ready-p2p-networking"><a class="doc-anchor" href="#networking-crate-for-icn---production-ready-p2p-networking">§</a>Networking Crate for ICN - Production-Ready P2P Networking</h2>
<p>This crate manages peer-to-peer (P2P) networking aspects for ICN,
using libp2p for distributed communication between nodes.</p>
</div></details><h2 id="reexports" class="section-header">Re-exports<a href="#reexports" class="anchor">§</a></h2><dl class="item-table reexports"><dt id="reexport.MeshNetworkError"><code>pub use error::<a class="enum" href="error/enum.MeshNetworkError.html" title="enum icn_network::error::MeshNetworkError">MeshNetworkError</a>;</code></dt></dl><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><dl class="item-table"><dt><a class="mod" href="error/index.html" title="mod icn_network::error">error</a></dt><dt><a class="mod" href="libp2p_service/index.html" title="mod icn_network::libp2p_service">libp2p_<wbr>service</a></dt><dt><a class="mod" href="metrics/index.html" title="mod icn_network::metrics">metrics</a></dt></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.NetworkStats.html" title="struct icn_network::NetworkStats">Network<wbr>Stats</a></dt><dd>Comprehensive network statistics for monitoring and observability.</dd><dt><a class="struct" href="struct.PeerId.html" title="struct icn_network::PeerId">PeerId</a></dt><dd>Wrapper around a peer’s stable identifier used within the network layer.</dd><dt><a class="struct" href="struct.SignedMessage.html" title="struct icn_network::SignedMessage">Signed<wbr>Message</a></dt><dd>A network message signed by the sender.</dd><dt><a class="struct" href="struct.StubNetworkService.html" title="struct icn_network::StubNetworkService">Stub<wbr>Network<wbr>Service</a></dt><dd>Stub implementation for testing.</dd></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">§</a></h2><dl class="item-table"><dt><a class="constant" href="constant.DID_DOC_PREFIX.html" title="constant icn_network::DID_DOC_PREFIX">DID_<wbr>DOC_<wbr>PREFIX</a></dt><dd>Prefix for DID document records stored in the DHT.</dd><dt><a class="constant" href="constant.SERVICE_AD_PREFIX.html" title="constant icn_network::SERVICE_AD_PREFIX">SERVICE_<wbr>AD_<wbr>PREFIX</a></dt><dd>Prefix for service advertisement records stored in the DHT.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.NetworkService.html" title="trait icn_network::NetworkService">Network<wbr>Service</a></dt><dd>Network service trait definition.</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.decode_protocol_message.html" title="fn icn_network::decode_protocol_message">decode_<wbr>protocol_<wbr>message</a></dt><dd>Decode a raw byte slice into a <a href="../icn_protocol/struct.ProtocolMessage.html" title="struct icn_protocol::ProtocolMessage"><code>ProtocolMessage</code></a>.</dd><dt><a class="fn" href="fn.send_network_ping.html" title="fn icn_network::send_network_ping">send_<wbr>network_<wbr>ping</a></dt><dd>Placeholder function for testing network operations.</dd><dt><a class="fn" href="fn.sign_message.html" title="fn icn_network::sign_message">sign_<wbr>message</a></dt><dd>Create a <a href="struct.SignedMessage.html" title="struct icn_network::SignedMessage"><code>SignedMessage</code></a> by signing <code>message</code> with <code>signing_key</code> and recording <code>sender</code>.</dd><dt><a class="fn" href="fn.verify_message_signature.html" title="fn icn_network::verify_message_signature">verify_<wbr>message_<wbr>signature</a></dt><dd>Verify the signature contained in a <a href="struct.SignedMessage.html" title="struct icn_network::SignedMessage"><code>SignedMessage</code></a>.</dd></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><dl class="item-table"><dt><a class="type" href="type.Bid.html" title="type icn_network::Bid">Bid</a></dt><dt><a class="type" href="type.Job.html" title="type icn_network::Job">Job</a></dt><dd>Legacy type aliases for compatibility</dd><dt><a class="type" href="type.JobId.html" title="type icn_network::JobId">JobId</a></dt></dl></section></div></main></body></html>